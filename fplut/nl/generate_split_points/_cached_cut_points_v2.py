import torch, torch.nn.functional as F
from math import pi
from functools import partial

cut_points_dict = {
    "silu": [
        -20.359375,
        -17.109375,
        -8.3671875,
        -1.9755859375,
        -0.255615234375,
        -0.007244110107421875,
        0.0072174072265625,
        0.228515625,
        1.58203125,
        10.46875,
        65504.0,
    ],
    "relu": [0.0, 0.125, 0.25, 1.25, 5.25, 10.0, 26.0, 128.0, 384.0, 2432.0, 65504.0],
    "elu": [
        -8.3203125,
        -6.9765625,
        -1.16015625,
        -0.1602783203125,
        -0.0352783203125,
        -0.0040283203125,
        -0.0010976791381835938,
        -0.00012117624282836914,
        32.0,
        32800.0,
        65504.0,
    ],
    "celu_1.0": [
        -8.3203125,
        -6.9765625,
        -1.16015625,
        -0.1602783203125,
        -0.0352783203125,
        -0.0040283203125,
        -0.0010976791381835938,
        -0.00012117624282836914,
        32.0,
        32800.0,
        65504.0,
    ],
    "gelu_tanh": [
        -10.1328125,
        -5.1796875,
        -3.25390625,
        -1.06640625,
        -0.06658935546875,
        -0.00408935546875,
        -0.00018310546875,
        0.03106689453125,
        0.49560546875,
        3.39453125,
        65504.0,
    ],
    "exp": [
        -17.34375,
        -15.171875,
        -8.890625,
        -5.2734375,
        -2.35546875,
        -0.3583984375,
        0.91650390625,
        3.451171875,
        6.84765625,
        10.9453125,
        11.0859375,
    ],
    "gelu_standard": [
        -5.5390625,
        -5.15234375,
        -3.2265625,
        -1.064453125,
        -0.06671142578125,
        -0.00421142578125,
        -0.00030517578125,
        0.03094482421875,
        0.537109375,
        3.55078125,
        65504.0,
    ],
    "gelu": [
        -5.5390625,
        -5.15625,
        -3.18359375,
        -0.98046875,
        -0.1229248046875,
        -0.00374603271484375,
        0.0035247802734375,
        0.11322021484375,
        0.78076171875,
        4.10546875,
        65504.0,
    ],
    "selu": [
        -7.73046875,
        -5.93359375,
        -1.1552734375,
        -0.15478515625,
        -0.036285400390625,
        -0.005035400390625,
        -0.0011043548583984375,
        -0.0001220703125,
        0.0037841796875,
        4096.0,
        62336.0,
    ],
    "sigmoid": [
        -17.34375,
        -15.765625,
        -10.65625,
        -8.15625,
        -6.3046875,
        -4.421875,
        -2.6640625,
        -0.7998046875,
        1.9462890625,
        6.90234375,
        8.3203125,
    ],
    "hardswish": [
        -3.0,
        -2.984375,
        -1.87890625,
        -0.5390625,
        -0.059326171875,
        -0.000743865966796875,
        0.0034942626953125,
        0.11968994140625,
        0.78369140625,
        3.001953125,
        65504.0,
    ],
    "reciprocal": [
        1.531839370727539e-05,
        2.2590160369873047e-05,
        0.0004699230194091797,
        0.007053375244140625,
        0.08837890625,
        1.07421875,
        15.546875,
        244.5,
        3694.0,
        46560.0,
        65504.0,
    ],
    "rsqrt": [
        5.960464477539063e-08,
        7.748603820800781e-07,
        0.00011140108108520508,
        0.0018644332885742188, 
        0.030029296875,
        0.48193359375,
        7.7734375,
        129.75,
        2406.0,
        47456.0,
        65504.0,
    ],
    "tanh": [
        -4.5078125,
        -3.79296875,
        -1.55078125,
        -0.5302734375,
        -0.028564453125,
        0.0364990234375,
        0.423828125,
        1.076171875,
        2.0390625,
        4.0625,
        4.5078125,
    ],
    "mish": [
        -20.34375,
        -19.90625,
        -10.921875,
        -6.2265625,
        -1.615234375,
        -0.237060546875,
        -0.00699615478515625,
        0.01538848876953125,
        0.491455078125,
        4.70703125,
        65504.0
    ]
}

info = dict(
    acosh=dict(
        func=torch.acosh,
        x_range=(-65504, 65152),
        left_edge=1,
        right_edge=65152,
    ),
    acos=dict(func=torch.acos, x_range=(-1, 1), left_edge=-1, right_edge=1),
    asin=dict(func=torch.asin, x_range=(-1, 1), left_edge=-1, right_edge=1),
    asinh=dict(func=torch.asinh, x_range=(-65152, 65152), left_edge=-65152, right_edge=65152),
    atan=dict(func=torch.atan, x_range=(-1029.0, 1029.0), left_edge=-1029.0, right_edge=1029.0),
    atanh=dict(
        func=torch.atanh,
        x_range=(-0.99951171875, 0.99951171875),
    ),
    celu=dict(func=F.celu, x_range=(-8.3203125, 65504.0), left_edge=-8.3203125, right_edge=65504.0),
    cos=dict(func=torch.cos, x_range=(0, 2 * pi), left_edge=0, right_edge=2 * pi),
    cosh=dict(func=torch.cosh, x_range=(-11.78125, 11.78125), left_edge=-11.78125, right_edge=11.78125),
    elu=dict(func=F.elu, x_range=(-8.3203125, 65504), left_edge=-8.3203125, right_edge=65504),
    exp=dict(func=torch.exp, x_range=(-17.34375, 11.0859375), left_edge=-17.34375, right_edge=11.0859375),
    gelu_standard=dict(func=F.gelu, x_range=(-5.5390625, 65504), left_edge=-5.5390625, right_edge=65504),
    gelu_tanh=dict(
        func=partial(F.gelu, approximate="tanh"), x_range=(-10.1328125, 65504), left_edge=-10.1328125, right_edge=65504
    ),
    mish=dict(func=F.mish, x_range=(-20.34375, 65504), left_edge=-20.34375, right_edge=65504),
    relu=dict(func=F.relu, x_range=(0, 65504), left_edge=0, right_edge=65504),
    selu=dict(func=F.selu, x_range=(-7.73046875, 65504), left_edge=-7.73046875, right_edge=65504),
    sigmoid=dict(func=F.sigmoid, x_range=(-17.34375, 8.3203125), left_edge=-17.34375, right_edge=8.3203125),
    silu=dict(func=F.silu, x_range=(-20.359375, 65504), left_edge=-20.359375, right_edge=65504),
    sin=dict(func=torch.sin, x_range=(0, 2 * pi), left_edge=0, right_edge=2 * pi),
    sinh=dict(func=torch.sinh, x_range=(-11.78125, 11.78125), left_edge=-11.78125, right_edge=11.78125),
    softplus=dict(func=F.softsign, x_range=(-17.34375, 0.541015625), left_edge=-17.34375, right_edge=0.541015625),
    softsign=dict(func=lambda x: F.softsign(x.float()).half(), x_range=(-4096, 4096), left_edge=-4096, right_edge=4096),
    hardswish=dict(func=F.hardswish, x_range=(-3, 65504), left_edge=-3, right_edge=65504),
    tanh=dict(func=F.tanh, x_range=(-4.5078125, 4.5078125), left_edge=-4.5078125, right_edge=4.5078125),
    reciprocal=dict(func=torch.reciprocal, x_range=(1 / 65504, 65504), left_edge=1 / 65504, right_edge=65504),
    rsqrt=dict(func=lambda x: torch.rsqrt(x), x_range=((1/65504) ** 2, 65504), left_edge=(1/65504) ** 2, right_edge=65504),   
)
